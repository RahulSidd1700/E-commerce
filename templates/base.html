<!DOCTYPE html>
<html lang="en" data-bs-theme="light"> {# <-- Add data-bs-theme attribute here #}
<head>
    <meta charset="UTF-8">
    <title>{% block title %}E-Commerce{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light"> {# <-- bg-light will change with theme #}
    <a class="navbar-brand" href="{% url 'home' %}">Shop</a>
   <ul class="navbar-nav ms-auto">
    {% if user.is_authenticated %}
        <li class="nav-item">
            <span class="nav-link disabled" style="color: #555;">Hello, <strong>{{ user.username }}</strong></span>
        </li>
            {% if user.is_staff %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'admin_products' %}">Manage Products</a>
                </li>
            {% endif %}
        <li class="nav-item"><a class="nav-link" href="{% url 'cart' %}">Cart</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'order_history' %}">Order History</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'logout' %}">Logout</a></li>
    {% else %}
        <li class="nav-item"><a class="nav-link" href="{% url 'login' %}">Login</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'signup' %}">Signup</a></li>
    {% endif %}

   
    <li class="nav-item ms-3">
    <button class="btn btn-primary btn-sm" id="theme-toggle"> 
        Theme
    </button>
</li>
</ul>

</nav>

<div class="container mt-4">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}

    {% block content %}
    {% endblock %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const themeToggleBtn = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement; // This is the <html> tag

        // Function to set the theme
        function setTheme(theme) {
            htmlElement.setAttribute('data-bs-theme', theme);
            localStorage.setItem('theme', theme); // Save user preference
            
            // Adjust navbar specific classes if needed, though data-bs-theme handles most
            const navbar = document.querySelector('.navbar');
            if (navbar) {
                if (theme === 'dark') {
                    navbar.classList.remove('navbar-light', 'bg-light');
                    navbar.classList.add('navbar-dark', 'bg-dark');
                } else {
                    navbar.classList.remove('navbar-dark', 'bg-dark');
                    navbar.classList.add('navbar-light', 'bg-light');
                }
            }
        }

        // Check for saved theme preference or default to 'light'
        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme); // Apply the saved or default theme on load

        // Toggle theme on button click
        themeToggleBtn.addEventListener('click', function() {
            const currentTheme = htmlElement.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        });
    });
</script>
</body>
</html>